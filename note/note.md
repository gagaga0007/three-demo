# 渲染管线

渲染管线的作用是将 3D 模型转换为二维图像。

现代 GPU 所包含的渲染管线为可编程渲染管线，通过编程 GLSL 着色器语言控制一些渲染阶段的细节（使用 shader 对画布中每个像素点做处理）。

> 顶点数据 -> 顶点着色器 -> 形状装配 -> 几何着色器 -> 光栅化 -> 片段着色器 -> 测试与混合

# 图元装配和光栅化

## 图元

描述各种图形元素的函数叫图元，描述几何元素的称作几何图元（点、线、多边形），经过顶点着色器计算后的坐标会组装为组合图元。

如三角形，则顶点着色器就会执行三次。

> 图元装配：就是将我们设置的顶点、颜色、纹理等内容组装成为一个可渲染的多边形的过程。

## 光栅化

通过图元装配生成的多边形，计算像素并补充，剔除不可见部分，裁剪掉不在可视范围内的部分，最终生成可见的带有颜色数据的图形并绘制。

> 剔除：物体不可见部分会在渲染过程中被剔除，不参与绘制，节省渲染开销。

> 剪裁：在可视范围外的物体会被剪裁，不参与绘制，提高性能。

光栅化后，每一个像素点都包含了颜色、深度、纹理数据，称为片元。

片元着色器运行的次数由图形有多少个片元决定的。

## 逐片元挑选

通过一系列测试确定片元是否要显示，测试过程中会丢弃部分无用的片元内容，然后生成可绘制的二维图像绘制并显示。

### 深度测试

对 z 轴的值进行测试，值比较小的片元内容会覆盖值比较大的（近处遮挡远处）。

### 模板测试

模拟观察者的观察行为（镜像观察），标记所有镜像中出现的片元，最后只绘制有标记的内容。
